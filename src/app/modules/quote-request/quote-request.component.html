<div id="rfq" class="rfq-container card">

  <tabset #staticTabs justified="true">
    <tab *ngIf="showFastTrack" heading="Fast Track" customClass="custom-tab">
      <app-fast-track [opportunitySection]="opportunitySection" [opportunityId]="opportunityId"></app-fast-track>
    </tab>
    
    <tab heading="Custom" customClass="custom-tab">
      <form id="form-custom" class="container-fluid" [formGroup]="rfqForm">

        <div class="row" *ngIf="formModeList && formModeList.length">
          <div class="col-12">
            <div class="mode-tabs">
              <button type="button" class="btn btn-block" *ngFor="let mode of formModeList" (click)="toggleFormMode(mode)" 
                [ngClass]="{
                  'active': mode.checked
                }">
                {{mode.title}}
              </button>
            </div>
          </div>
        </div>
    
        <div class="row section" formGroupName="segment_section">
          <h3 class="col-12">Segment</h3>
          
          <div class="col-12 col-sm-6">
            <div class="form-group" [ngClass]="{'required': getControlIsRequired(getSegmentSection.get('segment'))}">
              <label class="control-label">Segment</label>
              <div class="field-number">
                <div class="number">1</div>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Select segment'"
                  [settings]="getDropdownSettings()" [data]="segmentList" formControlName="segment"
                  [ngClass]="{'multiselect-invalid': getSegmentSection.get('segment').invalid && (getSegmentSection.get('segment').touched || getSegmentSection.get('segment').dirty)}">
                </ng-multiselect-dropdown>
              </div>
              <div class="invalid-multiselect-message" *ngIf="getSegmentSection.get('segment').invalid && (getSegmentSection.get('segment').touched || getSegmentSection.get('segment').dirty)">Segment is required</div>
            </div>
            <div class="form-group" [tooltip]="!getDataSingleSelect(getSegmentSection.get('segment').value) ? 'Please select segment first' : ''"
              [ngClass]="{'required': getControlIsRequired(getSegmentSection.get('segment_type'))}">
              <label class="control-label">Sub Segment</label>
              <div class="field-number">
                <div class="number">2</div>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Select sub segment'"
                  [settings]="getDropdownSettings()" [data]="segmentTypeList" formControlName="segment_type"
                  [ngClass]="{
                    'multiselect-invalid': getSegmentSection.get('segment_type').invalid && (getSegmentSection.get('segment_type').touched || getSegmentSection.get('segment_type').dirty),
                    'disabled': !getDataSingleSelect(getSegmentSection.get('segment').value)
                  }">
                </ng-multiselect-dropdown>
              </div>
              <div class="invalid-multiselect-message" *ngIf="getSegmentSection.get('segment_type').invalid && (getSegmentSection.get('segment_type').touched || getSegmentSection.get('segment_type').dirty)">Sub Segment is required</div>
            </div>
            <div class="form-group" *ngIf="getControlSelectedOtherCategory(getSegmentSection.get('segment_type').value)">
              <label class="control-label">Type in sub segment</label>
              <input type="text" class="form-control" placeholder="Type in sub segment" formControlName="other_segment_type">
            </div>
          </div>
          
          <div class="col-12 col-sm-6">
            <div class="form-group" [tooltip]="!getDataSingleSelect(getSegmentSection.get('segment_type').value) ? 'Please select sub segment first' : ''"
              [ngClass]="{'required': getControlIsRequired(getSegmentSection.get('packed_goods'))}">
              <label class="control-label">Packed Goods Type</label>
              <div class="field-number">
                <div class="number">3</div>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Select packed goods type'"
                  [settings]="getDropdownSettings()" [data]="packetGoodsList" formControlName="packed_goods"
                  [ngClass]="{
                    'multiselect-invalid': getSegmentSection.get('packed_goods').invalid && (getSegmentSection.get('packed_goods').touched || getSegmentSection.get('packed_goods').dirty),
                    'multiselect-underDev': packedGoodsIsOther,
                    'disabled': !getDataSingleSelect(getSegmentSection.get('segment_type').value)
                  }">
                </ng-multiselect-dropdown>
              </div>
              <div class="invalid-multiselect-message" *ngIf="getSegmentSection.get('packed_goods').invalid && (getSegmentSection.get('packed_goods').touched || getSegmentSection.get('packed_goods').dirty)">Packed goods type is required</div>
            </div>
            <div class="form-group" *ngIf="packedGoodsIsOther">
              <label class="control-label">Type in packed goods type</label>
              <input type="text" class="form-control" placeholder="Type in packed goods type" formControlName="other_packed_goods">
            </div>
            <div class="form-group">
              <label>Expected shelf life</label>
              <div class="field-number">
                <div class="number">4</div>
                <input type="text" class="form-control" placeholder="Expected shelf life" formControlName="expected_shelf_life">
              </div>
            </div>
          </div>
        </div>
    
        <div class="row section" formGroupName="application_section">
          <h3 class="col-12">Application Format</h3>
          
          <div class="col-12 col-sm-6">
            <div class="form-group" [tooltip]="packagingIsDisabled ? 'Packaging / Reel is readonly' : ''"
              [ngClass]="{'required': getControlIsRequired(getApplicationSection.get('packaging'))}">
              <label class="control-label">Packaging / Reel</label>
              <div class="field-number">
                <div class="number">1</div>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Packaging / Reel'"
                  [settings]="getDropdownSettings()" [data]="packagingList" formControlName="packaging"
                  [ngClass]="{
                    'multiselect-invalid': getApplicationSection.get('packaging').invalid && (getApplicationSection.get('packaging').touched || getApplicationSection.get('packaging').dirty),
                    'disabled': packagingIsDisabled
                  }">
                </ng-multiselect-dropdown>
              </div>
              <div class="invalid-multiselect-message" *ngIf="getApplicationSection.get('packaging').invalid && (getApplicationSection.get('packaging').touched || getApplicationSection.get('packaging').dirty)">Packaging / Reel is required</div>
            </div>
            <div class="form-group" [tooltip]="getApplicationSection.get('packaging').invalid ? 'Please select packaging/reel first' : ''"
              [ngClass]="{'required': getControlIsRequired(getApplicationSection.get('application'))}">
              <label class="control-label">Application</label>
              <div class="field-number">
                <div class="number">2</div>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Application'"
                  [settings]="getDropdownSettings()" [data]="applicationList" formControlName="application"
                  [ngClass]="{
                    'multiselect-invalid': getApplicationSection.get('application').invalid && (getApplicationSection.get('application').touched || getApplicationSection.get('application').dirty),
                    'disabled': (getApplicationSection.get('packaging').invalid) || (applicationIsDisabled)
                  }">
                </ng-multiselect-dropdown>
              </div>
              <div class="invalid-multiselect-message" *ngIf="getApplicationSection.get('application').invalid && (getApplicationSection.get('application').touched || getApplicationSection.get('application').dirty)">Application is required</div>
            </div>
          </div>
    
          <div class="col-12 col-sm-6">
            <div class="form-group" [tooltip]="getApplicationSection.get('application').invalid ? 'Please select application first' : ''"
              [ngClass]="{'required': getControlIsRequired(getApplicationSection.get('application_type'))}">
              <label class="control-label">Application Type</label>
              <div class="field-number">
                <div class="number">3</div>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Application Type'"
                  [settings]="getDropdownSettings()" [data]="applicationTypeList" formControlName="application_type"
                  [ngClass]="{
                    'multiselect-invalid': getApplicationSection.get('application_type').invalid && (getApplicationSection.get('application_type').touched || getApplicationSection.get('application_type').dirty),
                    'disabled': (getApplicationSection.get('application').invalid) || (applicationTypeIsDisabled),
                    'multiselect-commercial': applicationTypeIsCommercial,
                    'multiselect-underDev': (applicationTypeIsUnderDev) || (applicationTypeNotMatchPackedGoods),
                    'multiselect-futureDev': (applicationTypeStageInfo && applicationTypeStageInfo?.id === stageItemIds.FUTURE_DEVELOPMENT)
                  }">
                </ng-multiselect-dropdown>
              </div>
              <div class="invalid-multiselect-message" *ngIf="getApplicationSection.get('application_type').invalid && (getApplicationSection.get('application_type').touched || getApplicationSection.get('application_type').dirty)">Application type is required</div>
              <div class="invalid-multiselect-message color-black" *ngIf="applicationTypeNotMatchPackedGoods">{{feedbackSection?.packed_goods?.applTypeNotMatchPackedGoods?.title}}</div>
              <div class="invalid-multiselect-message color-black" *ngIf="filteredApplicationInfo && applicationTypeIsUnderDev">
                <ng-template #tolApplicationInfoTemplate>
                  <div [innerHTML]="(filteredApplicationInfo) ? filteredApplicationInfo.terms_and_limitations : ''"></div>
                </ng-template>
                <button type="button" class="btn btn-sm btn-link tooltip-btn" [tooltip]="tolApplicationInfoTemplate" triggers="focus"><u>{{feedbackSection?.production?.applTypeIsUnderDev?.title}}</u></button>
              </div>
              <div class="invalid-multiselect-message color-black" *ngIf="applicationTypeStageInfo && applicationTypeStageInfo?.id === stageItemIds.FUTURE_DEVELOPMENT">This application type is a future development and requires approval by your direct manager and the Product Marketing Manager</div>
              <!-- <div class="invalid-multiselect-message color-black" *ngIf="similarApplications">
                Please choose a product
              </div> -->
            </div>
            <div class="form-group" *ngIf="getControlSelectedOtherCategory(getApplicationSection.get('application_type').value)">
              <label>Type in Application Type</label>
              <input type="text" class="form-control" placeholder="Type in Application Type" formControlName="other_application_type">
            </div>
            <div class="form-group" *ngIf="estimatedApplicationTypeIsVisible"
              [ngClass]="{'required': getControlIsRequired(getApplicationSection.get('estimated_application_type'))}">
              <label class="control-label">Estimated Application Type</label>
              <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Estimated Application Type'"
                [settings]="getDropdownSettings()" [data]="estimatedApplicationTypeList" formControlName="estimated_application_type"
                [ngClass]="{
                  'multiselect-invalid': getApplicationSection.get('estimated_application_type').invalid && (getApplicationSection.get('estimated_application_type').touched || getApplicationSection.get('estimated_application_type').dirty)
                }">
              </ng-multiselect-dropdown>
              <div class="invalid-multiselect-message" *ngIf="getApplicationSection.get('estimated_application_type').invalid && (getApplicationSection.get('estimated_application_type').touched || getApplicationSection.get('estimated_application_type').dirty)">Estimated Application type is required</div>
            </div>
            <div class="form-group" *ngIf="estimatedApplicationTypeIsOther">
              <label>Type in Estimated Application Type</label>
              <input type="text" class="form-control" placeholder="Type in Estimated Application Type" formControlName="other_estimated_application_type">
            </div>
          </div>
        </div>
    
        <div class="row section" formGroupName="product_section">
          <h3 class="col-12">Product</h3>
    
          <div class="col-12 col-sm-6">
            <div class="form-group" [tooltip]="!productAndFamilyIsVisible ? 'Please select applications fields first' : ''"
              [ngClass]="{'required': getControlIsRequired(getProductSection.get('product_family'))}">
              <label class="control-label">Product family</label>
              <div class="field-number">
                <div class="number">1</div>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Product family'"
                  [settings]="getDropdownSettings()" [data]="productFamilyList" formControlName="product_family"
                  [ngClass]="{
                    'multiselect-invalid': getProductSection.get('product_family').invalid && (getProductSection.get('product_family').touched || getProductSection.get('product_family').dirty),
                    'disabled': !productAndFamilyIsVisible
                  }">
                </ng-multiselect-dropdown>
              </div>
              <div class="invalid-multiselect-message" *ngIf="getProductSection.get('product_family').invalid && (getProductSection.get('product_family').touched || getProductSection.get('product_family').dirty)">Product family is required</div>
            </div>
            <div class="form-group" [tooltip]="!productAndFamilyIsVisible ? 'Please select applications fields first' : ''"
              [ngClass]="{'required': getControlIsRequired(getProductSection.get('product'))}">
              <label class="control-label">Product</label>
              <div class="field-number">
                <div class="number">2</div>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Product'"
                  [settings]="getDropdownSettings()" [data]="productList" formControlName="product"
                  [ngClass]="{
                    'multiselect-invalid': getProductSection.get('product').invalid && (getProductSection.get('product').touched || getProductSection.get('product').dirty),
                    'multiselect-commercial': productIsCommercial,
                    'multiselect-underDev': (productIsUnderDev) || (productNotMatchSegmentType) || (productNotMatchPackedGoods),
                    'multiselect-futureDev': (productStageInfo && productStageInfo?.id === stageItemIds.FUTURE_DEVELOPMENT),
                    'disabled': !productAndFamilyIsVisible
                  }">
                  <ng-template #optionsTemplate let-item let-option="option" let-id="id" let-isSelected="isSelected">
                    <div class="tmp-item" *ngIf="getTmpItemProduct(id) as tmpItemInfo; else defaultTmpItem">
                      <app-stage-color-picker *ngIf="tmpItemInfo?.stage" [stage]="tmpItemInfo?.stage" disabled="true"></app-stage-color-picker>
                      <div>{{tmpItemInfo?.title}}</div>
                    </div>
                    <ng-template #defaultTmpItem>
                      <div>{{option}}</div>
                    </ng-template>
                  </ng-template>
                </ng-multiselect-dropdown>
              </div>
              <div class="invalid-multiselect-message" *ngIf="getProductSection.get('product').invalid && (getProductSection.get('product').touched || getProductSection.get('product').dirty)">Product is required</div>
              <!-- <div class="invalid-multiselect-message color-black" *ngIf="productNotMatchSegmentType">{{feedbackSection?.packed_goods?.productNotMatchSegmentType?.title}}</div> -->
              <div class="invalid-multiselect-message color-black" *ngIf="productStageInfo && productStageInfo?.id === stageItemIds?.FUTURE_DEVELOPMENT">This product is a future development and requires approval by your direct manager and the Product Marketing Manager</div>
              <div class="invalid-multiselect-message color-black" *ngIf="productNotMatchPackedGoods">{{feedbackSection?.packed_goods?.productNotMatchPackedGoods?.title}}</div>
              <div class="invalid-multiselect-message color-black" *ngIf="selectedProductInfo && productIsUnderDev">
                <ng-template #tolProductInfoTemplate>
                  <div [innerHTML]="(selectedProductInfo) ? selectedProductInfo.terms_and_limitations : ''"></div>
                </ng-template>
                <button type="button" class="btn btn-sm btn-link tooltip-btn" [tooltip]="tolProductInfoTemplate" triggers="focus"><u>{{feedbackSection?.production?.productIsUnderDev?.title}}</u></button>
              </div>
            </div>
            <div class="form-group" tooltip="Film grade is readonly">
              <label>Film grade</label>
              <div class="field-number">
                <div class="number">3</div>
                <ng-multiselect-dropdown class="custom-multiselect disabled" [placeholder]="'Film grade'"
                  [settings]="getDropdownSettings()" [data]="filmGradeList" formControlName="film_grade">
                </ng-multiselect-dropdown>
              </div>
            </div>
          </div>
          
          <div class="col-12 col-sm-6">
            <div class="form-group" tooltip="Cast/Blown is readonly">
              <label>Cast/Blown</label>
              <input type="text" class="form-control disabled" placeholder="Cast/Blown" formControlName="manufacturing_technique" readonly>
            </div>
            <div class="form-group" [ngClass]="{'required': getControlIsRequired(getProductSection.get('thickness'))}">
              <label class="control-label">Thickness</label>
              <div class="field-number">
                <div class="number">4</div>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Thickness'"
                  [settings]="getDropdownSettings()" [data]="thicknessList" formControlName="thickness"
                  [ngClass]="{
                    'multiselect-invalid': getProductSection.get('thickness').invalid && (getProductSection.get('thickness').touched || getProductSection.get('thickness').dirty),
                    'multiselect-commercial': selectedThickness?.isCommercial,
                    'multiselect-underDev': selectedThickness?.isUnderDev,
                    'multiselect-futureDev': selectedThickness?.stage === stageItemIds?.FUTURE_DEVELOPMENT
                  }">
                  <ng-template #optionsTemplate let-item let-option="option" let-id="id" let-isSelected="isSelected">
                    <div class="tmp-item" *ngIf="getTmpItemThickness(id) as tmpItemInfo; else defaultTmpItem">
                      <app-stage-color-picker *ngIf="tmpItemInfo?.stage" [stage]="tmpItemInfo?.stage" disabled="true"></app-stage-color-picker>
                      <div>{{tmpItemInfo?.title}}</div>
                    </div>
                    <ng-template #defaultTmpItem>
                      <div>{{option}}</div>
                    </ng-template>
                  </ng-template>
                </ng-multiselect-dropdown>
              </div>
              <div class="invalid-multiselect-message" *ngIf="getProductSection.get('thickness').invalid && (getProductSection.get('thickness').touched || getProductSection.get('thickness').dirty)">Thickness is required</div>
              <div class="invalid-multiselect-message color-black" *ngIf="feedbackSection?.production?.thicknessIsNotSK?.checked">{{feedbackSection?.production?.thicknessIsNotSK?.title}}</div>
            </div>
          </div>
        </div>
    
        <div class="section additionalFeatures-section" formArrayName="additional_features_section" *ngIf="additionalFeaturesSectionIsVisible && getAdditionalFeaturesSection.controls.length">
          <div class="row">
            <h3 class="col-12">Additional features</h3>
          </div>
    
          <div class="row" *ngFor="let controlParent of getAdditionalFeaturesSection.controls; let controlParentIndex = index" [formGroupName]="controlParentIndex">
            <h5 class="col-12">{{controlParent.get('parent').value}}</h5>
            
            <div class="col-12 feature-list" formArrayName="list">
              <div class="row feature-item" *ngFor="let controlFeature of getAdditionalFeatureListArray(controlParent).controls; let controlFeatureIndex = index" [formGroupName]="controlFeatureIndex">
                <div class="col-12 col-sm-6">
                  <div class="info">
                    <input type="checkbox" class="form-control" formControlName="selected">
                    <app-stage-color-picker [stage]="controlFeature.get('stage').value" disabled="true"></app-stage-color-picker>
                    <span>{{controlFeature.get('additional_feature').value}}</span>
                  </div>
                </div>
                <div class="col-12 col-sm-6" *ngIf="controlFeature.get('selected').value">
                  <div class="row" formArrayName="additional_feature_hints">
                    <div class="col-6" *ngFor="let controlFeatureHint of getAdditionalFeatureHintsArray(controlFeature).controls; let controlFeatureHintIndex = index" [formGroupName]="controlFeatureHintIndex">
                      <div class="form-group" [ngClass]="{'required': getControlIsRequired(controlFeatureHint.get('hint_value'))}">
                        <label class="control-label">{{controlFeatureHint.get('hint_name').value}}</label>
                        <input type="text" class="form-control" placeholder="Enter" formControlName="hint_value"
                          [ngClass]="{
                            'is-invalid': controlFeatureHint.get('hint_value').invalid && (controlFeatureHint.get('hint_value').touched || controlFeatureHint.get('hint_value').dirty)
                          }">
                        <div class="invalid-multiselect-message" *ngIf="controlFeatureHint.get('hint_value').invalid && (controlFeatureHint.get('hint_value').touched || controlFeatureHint.get('hint_value').dirty)">Field is required</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
    
        <div class="section" formGroupName="dimensions_section" *ngIf="getApplicationSection.get('packaging').valid">
          <div class="row">
            <h3 class="col-12">Dimensions</h3>
          </div>
    
          <ng-container *ngIf="getIsPackaging()">
            <div class="row">
              <div class="col-12 col-sm-6">
                <div class="form-group" [ngClass]="{'required': getControlIsRequired(getDimensionsSection.get('width'))}">
                  <label class="control-label">Width 
                    <span class="commercial-color" *ngIf="width && width.commer && width.commer.placeholder">({{width.commer.placeholder}})</span>
                    <span class="underDev-color" *ngIf="width && (!width.commer) && (width.underDev && width.underDev.placeholder)">({{width.underDev.placeholder}})</span>
                    <span class="futureDev-color" *ngIf="width && (!width.commer && !width.underDev) && (width?.futureDev && width?.futureDev?.placeholder)">({{width?.futureDev?.placeholder}})</span>
                  </label>
                  <input type="number" min="0" class="form-control" placeholder="Width" formControlName="width"
                    [ngClass]="{
                      'is-invalid': getDimensionsSection.get('width').invalid && (getDimensionsSection.get('width').touched || getDimensionsSection.get('width').dirty),
                      'commercial-border': widthIsCommercial,
                      'underDev-border': widthIsUnderDev
                    }">
                  <div class="invalid-multiselect-message" *ngIf="getDimensionsSection.get('width').invalid && (getDimensionsSection.get('width').touched || getDimensionsSection.get('width').dirty)">Width is required</div>
                  <div class="invalid-multiselect-message color-black" *ngIf="widthIsUnderDev">{{feedbackSection?.production?.widthIsNotSK?.title}}</div>
                </div>
                <div class="form-group">
                  <label>Height 
                    <span class="commercial-color" *ngIf="height && height.commer && height.commer.placeholder">({{height.commer.placeholder}})</span>
                    <span class="underDev-color" *ngIf="height && (!height.commer) && (height.underDev && height.underDev.placeholder)">({{height.underDev.placeholder}})</span>
                    <span class="futureDev-color" *ngIf="height && (!height.commer && !height.underDev) && (height?.futureDev && height?.futureDev?.placeholder)">({{height?.futureDev?.placeholder}})</span>
                  </label>
                  <input type="number" min="0" class="form-control" placeholder="Height" formControlName="height"
                    [ngClass]="{
                      'commercial-border': heightIsCommercial,
                      'underDev-border': heightIsUnderDev || heightPlusFlapIsMoreMaxHeight
                    }">
                  <div class="invalid-multiselect-message color-black" *ngIf="heightIsUnderDev">{{feedbackSection?.production?.heightIsNotSK?.title}}</div>
                  <div class="invalid-multiselect-message color-black" *ngIf="heightPlusFlapIsMoreMaxHeight">{{feedbackSection?.production?.heightPlusFlapIsMoreMaxHeight?.title}}</div>
                </div>
              </div>
      
              <div class="col-12 col-sm-6">
                <div class="form-group" *ngIf="isVisibleFlapField"
                  [ngClass]="{'required': getControlIsRequired(getDimensionsSection.get('flap'))}">
                  <label class="control-label">Flap</label>
                  <input type="number" min="0" class="form-control" placeholder="Flap" formControlName="flap"
                    [ngClass]="{
                      'is-invalid': getDimensionsSection.get('flap').invalid && (getDimensionsSection.get('flap').touched || getDimensionsSection.get('flap').dirty)
                    }">
                  <div class="invalid-multiselect-message" *ngIf="getDimensionsSection.get('flap').invalid && (getDimensionsSection.get('flap').touched || getDimensionsSection.get('flap').dirty)">Flap is required</div>
                </div>
                <div class="form-group" *ngIf="isVisibleGussetField" 
                  [ngClass]="{'required': getControlIsRequired(getDimensionsSection.get('closed_gusset'))}">
                  <label class="control-label">Closed gusset (mm)</label>
                  <input type="number" min="0" class="form-control" placeholder="Closed gusset (mm)" formControlName="closed_gusset"
                    [ngClass]="{
                      'is-invalid': getDimensionsSection.get('closed_gusset').invalid && (getDimensionsSection.get('closed_gusset').touched || getDimensionsSection.get('closed_gusset').dirty)
                    }">
                  <div class="invalid-multiselect-message" *ngIf="getDimensionsSection.get('closed_gusset').invalid && (getDimensionsSection.get('closed_gusset').touched || getDimensionsSection.get('closed_gusset').dirty)">Closed gusset is required</div>
                </div>
              </div>
            </div>
          </ng-container>
    
          <ng-container *ngIf="getIsReel()">
            <div class="row">
              <div class="col-12 col-sm-6">
                <div class="form-group" [ngClass]="{'required': getControlIsRequired(getDimensionsSection.get('width'))}">
                  <label class="control-label">Width (mm) 
                    <span class="commercial-color" *ngIf="width && width.commer && width.commer.placeholder">({{width.commer.placeholder}})</span>
                    <span class="underDev-color" *ngIf="width && (!width.commer) && (width.underDev && width.underDev.placeholder)">({{width.underDev.placeholder}})</span>
                    <span class="underDev-color" *ngIf="width && (!width.commer && !width.underDev) && (width?.futureDev && width?.futureDev?.placeholder)">({{width?.futureDev?.placeholder}})</span>
                  </label>
                  <input type="number" min="0" class="form-control" placeholder="Width (mm)" formControlName="width"
                    [ngClass]="{
                      'is-invalid': getDimensionsSection.get('width').invalid && (getDimensionsSection.get('width').touched || getDimensionsSection.get('width').dirty),
                      'commercial-border': widthIsCommercial,
                      'underDev-border': widthIsUnderDev
                    }">
                  <div class="invalid-multiselect-message" *ngIf="getDimensionsSection.get('width').invalid && (getDimensionsSection.get('width').touched || getDimensionsSection.get('width').dirty)">Width is required</div>
                  <div class="invalid-multiselect-message color-black" *ngIf="widthIsUnderDev">{{feedbackSection?.production?.widthIsNotSK?.title}}</div>
                </div>
              </div>
            </div>
    
            <div class="row">
              <div class="col-12 col-sm-6">
                <div class="form-group" [ngClass]="{'required': getControlIsRequired(getDimensionsSection.get('core'))}">
                  <label class="control-label">Core (inch)</label>
                  <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Core (inch)'"
                    [settings]="getDropdownSettings()" [data]="coreList" formControlName="core"
                    [ngClass]="{
                      'multiselect-invalid': getDimensionsSection.get('core').invalid && (getDimensionsSection.get('core').touched || getDimensionsSection.get('core').dirty),
                      'multiselect-commercial': coreIsCommercial,
                      'multiselect-underDev': coreIsUnderDev
                    }">
                  </ng-multiselect-dropdown>
                  <div class="invalid-multiselect-message" *ngIf="getDimensionsSection.get('core').invalid && (getDimensionsSection.get('core').touched || getDimensionsSection.get('core').dirty)">Core is required</div>
                  <div class="invalid-multiselect-message color-black" *ngIf="coreIsUnderDev">{{feedbackSection?.production?.coreIsUnderDev?.title}}</div>
                </div>
                <div class="form-group" [ngClass]="{'required': getControlIsRequired(getDimensionsSection.get('reel_length_limitation'))}">
                  <label class="control-label">Reel length limitation (m)</label>
                  <input type="text" class="form-control" placeholder="Reel length limitation (m)" formControlName="reel_length_limitation"
                    [ngClass]="{
                      'is-invalid': getDimensionsSection.get('reel_length_limitation').invalid && (getDimensionsSection.get('reel_length_limitation').touched || getDimensionsSection.get('reel_length_limitation').dirty)
                    }">
                  <div class="invalid-multiselect-message" *ngIf="getDimensionsSection.get('reel_length_limitation').invalid && (getDimensionsSection.get('reel_length_limitation').touched || getDimensionsSection.get('reel_length_limitation').dirty)">Reel length or Reel weight is required</div>
                </div>
                <div class="form-group">
                  <label>Box weight limitation (kg)</label>
                  <input type="text" class="form-control" placeholder="Box weight limitation (kg)" formControlName="box_weight_limitation">
                </div>
              </div>
      
              <div class="col-12 col-sm-6">
                <div class="form-group" [ngClass]="{'required': getControlIsRequired(getDimensionsSection.get('od'))}">
                  <label class="control-label">OD (mm)</label>
                  <input type="text" class="form-control" placeholder="OD (mm)" formControlName="od"
                    [ngClass]="{
                      'is-invalid': getDimensionsSection.get('od').invalid && (getDimensionsSection.get('od').touched || getDimensionsSection.get('od').dirty)
                    }">
                  <div class="invalid-multiselect-message" *ngIf="getDimensionsSection.get('od').invalid && (getDimensionsSection.get('od').touched || getDimensionsSection.get('od').dirty)">Please enter an OD value or N/A</div>
                </div>
                <div class="form-group" [ngClass]="{'required': getControlIsRequired(getDimensionsSection.get('reel_weight_limitation'))}">
                  <label class="control-label">Reel weight limitation (kg)</label>
                  <input type="text" class="form-control" placeholder="Reel weight limitation (kg)" formControlName="reel_weight_limitation"
                    [ngClass]="{
                      'is-invalid': getDimensionsSection.get('reel_weight_limitation').invalid && (getDimensionsSection.get('reel_weight_limitation').touched || getDimensionsSection.get('reel_weight_limitation').dirty)
                    }">
                  <div class="invalid-multiselect-message" *ngIf="getDimensionsSection.get('reel_weight_limitation').invalid && (getDimensionsSection.get('reel_weight_limitation').touched || getDimensionsSection.get('reel_weight_limitation').dirty)">Reel length or Reel weight is required</div>
                </div>
                <div class="form-group" tooltip="0.3- When film used for lamination, 0.2- For all the rest">
                  <label>COF - Non-Printed film only</label>
                  <ng-multiselect-dropdown class="custom-multiselect" placeholder="COF"
                    [settings]="getDropdownSettings()" [data]="cofList" formControlName="cof">
                  </ng-multiselect-dropdown>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
    
        <div class="section graphics-section" formGroupName="graphics_section" *ngIf="graphicsSectionIsVisible">
          <div class="row">
            <h3 class="col-12">Graphics</h3>
          </div>
    
          <div class="row">
            <div class="col-12 col-sm-6">
              <div class="form-group printing">
                <div>
                  <label>Printing</label>
                  <app-stage-color-picker *ngIf="printingStageId" [stage]="printingStageId" disabled="true"></app-stage-color-picker>
                </div>
                <div class="radio-list">
                  <label>
                    <input type="radio" name="printing" class="form-control" [value]="true" formControlName="printing">
                    <span>Yes</span>
                  </label>
                  <label>
                    <input type="radio" name="printing" class="form-control" [value]="false" formControlName="printing">
                    <span>No</span>
                  </label>
                </div>
              </div>
            </div>
            <div class="col-12 col-sm-6" *ngIf="getGraphicsSection.get('printing').value">
              <div class="form-group">
                <!-- <label>Number of colors</label> -->
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Number of colors'"
                  [settings]="getDropdownSettings()" [data]="numberOfColorsList" formControlName="number_of_colors">
                </ng-multiselect-dropdown>
              </div>
            </div>
          </div>
    
          <div class="row">
            <div class="col-12" *ngIf="digitalPrintingNotAvailableFilm">
              <div class="dp-availableFilm">Please note: Request for digital printing is not available for film under 60μ.</div>
            </div>
            <div class="col-12 col-sm-6" *ngIf="digitalPrintingIsVisible">
              <div class="form-group printing">
                <div>
                  <label>Request for digital printing</label>
                  <app-stage-color-picker *ngIf="digitalPrintingStageId" [stage]="digitalPrintingStageId" disabled="true"></app-stage-color-picker>
                </div>
                <div class="radio-list">
                  <label>
                    <input type="radio" name="digital_printing" class="form-control" [value]="true" formControlName="digital_printing">
                    <span>Yes</span>
                  </label>
                  <label>
                    <input type="radio" name="digital_printing" class="form-control" [value]="false" formControlName="digital_printing">
                    <span>No</span>
                  </label>
                </div>
              </div>
              <div class="invalid-multiselect-message color-black" *ngIf="feedbackSection?.production?.digitalPrintingUnderDev?.checked">{{feedbackSection?.production?.digitalPrintingUnderDev?.title}}</div>
            </div>
          </div>
    
          <div class="row" *ngIf="externalLogoIsVisible && (getGraphicsSectionExternalLogo.controls.length || getGraphicsSection.get('rtf').value)">
            <div class="col-12">
              <label>Required Logo</label>
            </div>
            
            <div class="col-12" *ngIf="getGraphicsSection.get('rtf').value">
              <div class="form-group">
                <!-- <label>RTF</label> -->
                <div [innerHTML]="getGraphicsSection.get('rtf').value"></div>
              </div>
            </div>
    
            <div class="col-12" *ngIf="getGraphicsSectionExternalLogo.controls.length">
              <div class="form-group external-logo">
                <!-- <label>Required Logo</label> -->
                <div class="list" formArrayName="external_logo">
                  <div *ngFor="let control of getGraphicsSectionExternalLogo.controls; let i = index" [formGroupName]="i">
                    <label>
                      <input type="checkbox" class="form-control" formControlName="selected">
                      <span>{{control.value.certificate_name}}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
    
        <div class="section" formGroupName="other_section">
          <div class="row">
            <h3 class="col-12 text-center">This RFQ is for a:</h3>
          </div>

          <div class="row justify-content-around">
            <div class="col-auto">
              <h4>
                <label [for]="'rfqIsFor-' + rfqIsFor?.commercialOrder">{{rfqIsFor?.commercialOrder}}</label>
              </h4>
              <div class="d-flex justify-content-center">
                <input type="radio" [id]="'rfqIsFor-' + rfqIsFor?.commercialOrder" class="form-control" [value]="rfqIsFor?.commercialOrder" formControlName="rfq_is_for">
              </div>
            </div>
            <div class="col-auto">
              <h4>
                <label [for]="'rfqIsFor-' + rfqIsFor?.customerTrial">{{rfqIsFor?.customerTrial}}</label>
              </h4>
              <div class="d-flex justify-content-center">
                <input type="radio" [id]="'rfqIsFor-' + rfqIsFor?.customerTrial" class="form-control" [value]="rfqIsFor?.customerTrial" formControlName="rfq_is_for">
              </div>
            </div>
          </div>
        </div>

        <div class="section pricing-section" formGroupName="pricing_section">
          <div class="row">
            <h3 class="col-12">Pricing</h3>
          </div>
          
          <div class="row">
            <div class="col-2 col-sm-2">
              <div>
                <label>Currency</label>
              </div>
              <div class="currency-wrap">
                <label class="currency-item" *ngFor="let priceCurrency of priceCurrencyList">
                  <input type="radio" class="form-control" [value]="priceCurrency" formControlName="currency">
                  <span>{{priceCurrency}}</span>
                </label>
              </div>
            </div>
            <div class="col-10 col-sm-4">
              <div class="form-group" [ngClass]="{'required': getControlIsRequired(getPricingSection.get('pricing_measure_unit'))}">
                <label class="control-label">Pricing measure unit</label>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Pricing measure unit'"
                  [settings]="getDropdownSettings()" [data]="pricingMeasureUnitList" formControlName="pricing_measure_unit"
                  [ngClass]="{'multiselect-invalid': getPricingSection.get('pricing_measure_unit').invalid && (getPricingSection.get('pricing_measure_unit').touched || getPricingSection.get('pricing_measure_unit').dirty)}">
                </ng-multiselect-dropdown>
                <div class="invalid-multiselect-message" *ngIf="getPricingSection.get('pricing_measure_unit').invalid && (getPricingSection.get('pricing_measure_unit').touched || getPricingSection.get('pricing_measure_unit').dirty)">Pricing measure unit is required</div>
              </div>
              <div class="form-group" *ngIf="impFieldsIsVisible">
                <label>Imp width (mm)</label>
                <input type="number" min="0" class="form-control" placeholder="Imp width (mm)" formControlName="imp_width">
              </div>
              <div class="form-group" *ngIf="impFieldsIsVisible">
                <label>Imp height (mm)</label>
                <input type="number" min="0" class="form-control" placeholder="Imp height (mm)" formControlName="imp_height">
              </div>
            </div>
            <div class="col-8 col-sm-3" tooltip="MOQ is readonly">
              <div class="form-group">
                <label>MOQ</label>
                <input type="text" class="form-control" placeholder="MOQ" formControlName="moq" readonly>
                <div class="invalid-multiselect-message color-black" *ngIf="getPricingSection.get('moq').value === RFQ.nameNA">Manual pricing required for the selected options</div>
              </div>
            </div>
            <div class="col-4 col-sm-3">
              <div class="form-group">
                <label>Calculate</label>
                <button type="button" class="btn btn-info btn-block" (click)="calculateMoq()">Calc. MOQ</button>
              </div>
            </div>
          </div>
    
          <div class="items" formArrayName="items">
            <div class="row" *ngFor="let control of getPricingSectionItems.controls; let i = index" [formGroupName]="i">
              <div class="col-10 col-sm-4">
                <div class="form-group" [ngClass]="{'required': getControlIsRequired(control.get('quantity'))}">
                  <label class="control-label">Quantity</label>
                  <input type="number" min="0" class="form-control" placeholder="Quantity" formControlName="quantity"
                    (blur)="calculateRfqForm()"
                    [ngClass]="{
                      'is-invalid': control.get('quantity').invalid && control.get('quantity').touched,
                      'commercial-border': getIsQuantityCommercial(control),
                      'underDev-border': getIsQuantityUnderDev(control)
                    }">
                  <div class="invalid-multiselect-message" *ngIf="control.get('quantity').invalid && control.get('quantity').touched">Quantity is required</div>
                  <div class="invalid-multiselect-message color-black" *ngIf="control.get('private_quantity_note') && control.get('private_quantity_note').value">{{control.get('private_quantity_note').value}}</div>
                </div>
              </div>
              <div class="col-12 col-sm-4" tooltip="Price unit is readonly">
                <div class="form-group">
                  <label>Price unit</label>
                  <input type="text" class="form-control" placeholder="Price unit" formControlName="price_per_unit" readonly>
                  <div class="invalid-multiselect-message color-black" *ngIf="control.get('price_per_unit').value === RFQ.nameNA">Manual pricing required for the selected options</div>
                </div>
              </div>
              <div class="col-12 col-sm-4" tooltip="Total price is readonly">
                <div class="form-group">
                  <label>Total price</label>
                  <div class="price-and-remove">
                    <input type="text" class="form-control" placeholder="Total price" formControlName="price_total" readonly>
                    <i class="fas fa-trash-alt" *ngIf="getPricingSectionItems.controls.length > 1" (click)="removeItemsField(i)"></i>
                  </div>
                  <div class="invalid-multiselect-message color-black" *ngIf="control.get('price_total').value === RFQ.nameNA">Manual pricing required for the selected options</div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-12 col-sm-4">
                <div class="items-actions">
                  <button type="button" class="btn btn-outline-info" (click)="addItemsField()">Add quantity</button>
                </div>
              </div>
              <div class="col-12 col-sm-8">
                <div class="items-actions">
                  <button type="button" class="btn btn-info" [disabled]="getPricingSectionItems.invalid" (click)="calculateRfqForm()">Calculate price</button>
                </div>
              </div>
            </div>
          </div>
    
          <div class="row">
            <div class="col-12 col-sm-4">
              <div class="form-group" [ngClass]="{'required': getControlIsRequired(getPricingSection.get('shipping_terms'))}">
                <label class="control-label">Shipping terms (not included in total price)</label>
                <ng-multiselect-dropdown class="custom-multiselect" [placeholder]="'Shipping terms'"
                  [settings]="getDropdownSettings()" [data]="shippingTermsList" formControlName="shipping_terms"
                  [ngClass]="{'multiselect-invalid': getPricingSection.get('shipping_terms').invalid && (getPricingSection.get('shipping_terms').touched || getPricingSection.get('shipping_terms').dirty)}">
                </ng-multiselect-dropdown>
                <div class="invalid-multiselect-message" *ngIf="getPricingSection.get('shipping_terms').invalid && (getPricingSection.get('shipping_terms').touched || getPricingSection.get('shipping_terms').dirty)">Shipping terms is required</div>
              </div>
            </div>
          </div>

          <div class="line"></div>

          <div class="row">
            <div class="col-12 col-sm-4">
              <div class="form-group">
                <label class="control-label">Annual quantity potential</label>
                <input type="text" class="form-control" placeholder="Annual quantity potential" formControlName="annual_quantity_potential">
              </div>
            </div>
            <div class="col-12 col-sm-4">
              <div class="form-group">
                <label>Current material used</label>
                <input type="text" class="form-control" placeholder="Current material used" formControlName="current_material_used">
              </div>
            </div>
            <div class="col-12 col-sm-4">
              <div class="form-group">
                <label>Current price payed</label>
                <input type="number" min="0" class="form-control" placeholder="Current price payed" formControlName="current_price_payed">
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
              <div class="form-group">
                <label>Remarks</label>
                <textarea class="form-control" placeholder="Remarks" formControlName="remarks" autosize></textarea>
              </div>
            </div>
          </div>
        </div>
    
        <div class="actions">
          <button type="button" class="btn btn-info" (click)="saveRfqForm(true)">Submit</button>
          <button type="button" class="btn btn-outline-info" (click)="saveRfqForm(false)">Submit and Generate another item</button>
        </div>
    
        <div>
          <ng-container *ngIf="getCanBePriced(); else canNotBePriced">This item will be automaticly priced</ng-container>
          <ng-template #canNotBePriced>This item will go under review</ng-template>
        </div>
    
      </form>
    </tab>
  </tabset>

</div>